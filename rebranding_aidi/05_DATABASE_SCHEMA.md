# Ð¡Ñ…ÐµÐ¼Ð° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… AIDI.APP

*Ð”Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ: 27 ÑÐ½Ð²Ð°Ñ€Ñ 2025*
*Ð¦ÐµÐ»ÑŒ: ÐŸÐ¾Ð»Ð½Ð°Ñ SQL ÑÑ…ÐµÐ¼Ð° Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… AIDI.APP*

## ðŸ“‹ ÐžÐ±Ð·Ð¾Ñ€ ÑÑ…ÐµÐ¼Ñ‹

Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… AIDI.APP Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð° Ð½Ð° PostgreSQL Ð¸ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹:

- **ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹** - ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸ Ð¸ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑÐ¼Ð¸
- **ÐÐ½Ð°Ð»Ð¸Ð· Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¸** - Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
- **Ð”ÐµÑ‚ÐµÐºÑ†Ð¸Ñ Ð´Ð¸Ð¿Ñ„ÐµÐ¹ÐºÐ¾Ð²** - Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¼ÐµÐ´Ð¸Ð°Ñ„Ð°Ð¹Ð»Ð¾Ð²
- **KYC Ð²ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ** - Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹ Ð·Ð½Ð°Ð¹-ÑÐ²Ð¾ÐµÐ³Ð¾-ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
- **Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð²** - Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð²Ð°Ð»ÑŽÑ‚Ð° Ð¸ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð¸
- **ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ñ** - Ð´Ð»Ñ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°

## ðŸ—„ï¸ ÐŸÐ¾Ð»Ð½Ð°Ñ SQL ÑÑ…ÐµÐ¼Ð°

### 1. ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹

#### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° users
```sql
-- =====================================================
-- AIDI.APP Database Schema
-- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ: 27 ÑÐ½Ð²Ð°Ñ€Ñ 2025
-- ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ: ÐŸÐ¾Ð»Ð½Ð°Ñ ÑÑ…ÐµÐ¼Ð° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ ÑÐµÑ€Ð²Ð¸ÑÐ° Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¸ Ð¸ KYC
-- =====================================================

-- Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ PostgreSQL
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pg_trgm";
CREATE EXTENSION IF NOT EXISTS "btree_gin";

-- =====================================================
-- 1. ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐ¢Ð•Ð›Ð¬Ð¡ÐšÐ˜Ð• Ð¢ÐÐ‘Ð›Ð˜Ð¦Ð«
-- =====================================================

-- ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    language_code VARCHAR(10) DEFAULT 'ru',
    timezone VARCHAR(50) DEFAULT 'Europe/Moscow',
    
    -- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¸ Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ñ
    is_premium BOOLEAN DEFAULT FALSE,
    is_verified BOOLEAN DEFAULT FALSE,
    reputation_score INTEGER CHECK (reputation_score >= 0 AND reputation_score <= 100),
    verification_status VARCHAR(50) DEFAULT 'unverified' 
        CHECK (verification_status IN ('unverified', 'pending', 'verified', 'rejected')),
    
    -- ÐÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ
    last_activity_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    registration_source VARCHAR(100) DEFAULT 'telegram',
    referral_code VARCHAR(20) UNIQUE,
    referred_by_user_id UUID REFERENCES users(id),
    
    -- Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚ÐºÐ¸
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ users
CREATE INDEX idx_users_telegram_id ON users(telegram_id);
CREATE INDEX idx_users_username ON users(username) WHERE username IS NOT NULL;
CREATE INDEX idx_users_last_activity ON users(last_activity_at DESC);
CREATE INDEX idx_users_verification_status ON users(verification_status);
CREATE INDEX idx_users_referral_code ON users(referral_code) WHERE referral_code IS NOT NULL;
CREATE INDEX idx_users_created_at ON users(created_at DESC);

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ users
COMMENT ON TABLE users IS 'ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹';
COMMENT ON COLUMN users.telegram_id IS 'Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ID Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð² Telegram';
COMMENT ON COLUMN users.reputation_score IS 'Ð¡Ð¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ (0-100)';
COMMENT ON COLUMN users.verification_status IS 'Ð¡Ñ‚Ð°Ñ‚ÑƒÑ KYC Ð²ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ';
COMMENT ON COLUMN users.referral_code IS 'Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ð´ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ñ Ð½Ð¾Ð²Ñ‹Ñ… ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²';
```

#### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° user_profiles
```sql
-- ÐŸÑ€Ð¾Ñ„Ð¸Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼Ð¸
CREATE TABLE user_profiles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID UNIQUE NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
    analysis_preferences JSONB DEFAULT '{
        "reputation_depth": "basic",
        "deepfake_sensitivity": "medium",
        "auto_save_reports": true,
        "notification_frequency": "immediate"
    }',
    
    -- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ð¾ÑÑ‚Ð¸
    privacy_settings JSONB DEFAULT '{
        "data_sharing": false,
        "anonymous_analytics": true,
        "report_sharing": false,
        "profile_visibility": "private"
    }',
    
    -- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹
    notification_settings JSONB DEFAULT '{
        "reputation_alerts": true,
        "deepfake_alerts": true,
        "payment_notifications": true,
        "marketing_emails": false,
        "security_alerts": true
    }',
    
    -- ÐŸÐ¾Ð´Ð¿Ð¸ÑÐºÐ° Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿
    subscription_type VARCHAR(50) DEFAULT 'free' 
        CHECK (subscription_type IN ('free', 'basic', 'professional', 'enterprise')),
    subscription_expires_at TIMESTAMP WITH TIME ZONE,
    data_retention_days INTEGER DEFAULT 30 
        CHECK (data_retention_days >= 1 AND data_retention_days <= 365),
    
    -- API Ð´Ð¾ÑÑ‚ÑƒÐ¿
    api_access_enabled BOOLEAN DEFAULT FALSE,
    api_key VARCHAR(255) UNIQUE,
    api_rate_limit INTEGER DEFAULT 100, -- Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð² Ñ‡Ð°Ñ
    api_calls_made_today INTEGER DEFAULT 0,
    api_calls_reset_at TIMESTAMP WITH TIME ZONE DEFAULT (CURRENT_DATE + INTERVAL '1 day'),
    
    -- Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ
    usage_statistics JSONB DEFAULT '{
        "analyses_count": 0,
        "deepfake_checks": 0,
        "kyc_verifications": 0,
        "api_calls_total": 0,
        "credits_purchased": 0,
        "credits_used": 0
    }',
    
    -- Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚ÐºÐ¸
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ user_profiles
CREATE INDEX idx_user_profiles_user_id ON user_profiles(user_id);
CREATE INDEX idx_user_profiles_subscription ON user_profiles(subscription_type, subscription_expires_at);
CREATE INDEX idx_user_profiles_api_key ON user_profiles(api_key) WHERE api_key IS NOT NULL;
CREATE INDEX idx_user_profiles_api_reset ON user_profiles(api_calls_reset_at) WHERE api_access_enabled = TRUE;

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ user_profiles
COMMENT ON TABLE user_profiles IS 'Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼Ð¸ Ð¸ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¾Ð¹';
COMMENT ON COLUMN user_profiles.analysis_preferences IS 'ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¸ Ð¸ Ð´Ð¸Ð¿Ñ„ÐµÐ¹ÐºÐ¾Ð²';
COMMENT ON COLUMN user_profiles.data_retention_days IS 'ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´Ð½ÐµÐ¹ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð°Ð½Ð°Ð»Ð¸Ð·Ð¾Ð² (GDPR compliance)';
COMMENT ON COLUMN user_profiles.api_key IS 'API ÐºÐ»ÑŽÑ‡ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð½Ð¾Ð³Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº ÑÐµÑ€Ð²Ð¸ÑÑƒ';
COMMENT ON COLUMN user_profiles.usage_statistics IS 'Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ ÑÐµÑ€Ð²Ð¸ÑÐ° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼';
```

### 2. ÐÐ½Ð°Ð»Ð¸Ð· Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¸

#### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° reputation_analyses
```sql
-- =====================================================
-- 2. ÐÐÐÐ›Ð˜Ð— Ð Ð•ÐŸÐ£Ð¢ÐÐ¦Ð˜Ð˜
-- =====================================================

-- ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ð°Ð½Ð°Ð»Ð¸Ð·Ð¾Ð² Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¸
CREATE TABLE reputation_analyses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- Ð”Ð°Ð½Ð½Ñ‹Ðµ Ñ†ÐµÐ»Ð¸ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
    target_name VARCHAR(255),
    target_phone VARCHAR(50),
    target_email VARCHAR(255),
    target_photo_url TEXT,
    target_social_profiles JSONB DEFAULT '{}', -- {"vk": "id123", "telegram": "@username"}
    target_additional_info JSONB DEFAULT '{}', -- Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ
    
    -- ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
    analysis_type VARCHAR(50) NOT NULL 
        CHECK (analysis_type IN ('basic', 'extended', 'deep', 'forensic')),
    search_depth VARCHAR(50) DEFAULT 'standard' 
        CHECK (search_depth IN ('surface', 'standard', 'deep', 'comprehensive')),
    data_sources JSONB DEFAULT '["social_media", "public_records"]', -- Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¸ Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ°
    geographic_scope VARCHAR(100) DEFAULT 'russia', -- Ð³ÐµÐ¾Ð³Ñ€Ð°Ñ„Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¾Ñ…Ð²Ð°Ñ‚ Ð¿Ð¾Ð¸ÑÐºÐ°
    time_range_months INTEGER DEFAULT 12, -- Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ð¿Ð¾Ð¸ÑÐºÐ° Ð² Ð¼ÐµÑÑÑ†Ð°Ñ…
    
    -- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¸ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ
    status VARCHAR(50) DEFAULT 'pending' 
        CHECK (status IN ('pending', 'processing', 'completed', 'failed', 'cancelled', 'expired')),
    progress_percentage INTEGER DEFAULT 0 
        CHECK (progress_percentage >= 0 AND progress_percentage <= 100),
    current_stage VARCHAR(100), -- Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ‚Ð°Ð¿ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
    
    -- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ ÑÐºÐ¾Ñ€Ð¸Ð½Ð³Ð° (0-100)
    risk_score INTEGER CHECK (risk_score >= 0 AND risk_score <= 100),
    credibility_score INTEGER CHECK (credibility_score >= 0 AND credibility_score <= 100),
    activity_score INTEGER CHECK (activity_score >= 0 AND activity_score <= 100),
    professional_score INTEGER CHECK (professional_score >= 0 AND professional_score <= 100),
    
    -- Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸
    sentiment_score DECIMAL(3,2) CHECK (sentiment_score >= -1.00 AND sentiment_score <= 1.00),
    influence_score INTEGER CHECK (influence_score >= 0 AND influence_score <= 100),
    controversy_score INTEGER CHECK (controversy_score >= 0 AND controversy_score <= 100),
    
    -- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
    results JSONB DEFAULT '{}', -- Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
    executive_summary TEXT, -- ÐºÑ€Ð°Ñ‚ÐºÐ¾Ðµ Ñ€ÐµÐ·ÑŽÐ¼Ðµ
    detailed_report TEXT, -- Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡ÐµÑ‚
    recommendations TEXT, -- Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸
    
    -- ÐÐ°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
    sources_found INTEGER DEFAULT 0,
    profiles_found INTEGER DEFAULT 0,
    mentions_found INTEGER DEFAULT 0,
    documents_found INTEGER DEFAULT 0,
    
    -- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ñ‹
    red_flags JSONB DEFAULT '[]', -- Ð½ÐµÐ³Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ñ‹
    positive_indicators JSONB DEFAULT '[]', -- Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ñ‹
    neutral_facts JSONB DEFAULT '[]', -- Ð½ÐµÐ¹Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ„Ð°ÐºÑ‚Ñ‹
    
    -- Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ
    credits_used INTEGER DEFAULT 1,
    processing_time_ms INTEGER,
    ai_model_version VARCHAR(50),
    data_quality_score DECIMAL(3,2) CHECK (data_quality_score >= 0.00 AND data_quality_score <= 1.00),
    confidence_level DECIMAL(3,2) CHECK (confidence_level >= 0.00 AND confidence_level <= 1.00),
    
    -- ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð¸ Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ
    error_message TEXT,
    warnings JSONB DEFAULT '[]',
    
    -- Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚ÐºÐ¸
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    started_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    expires_at TIMESTAMP WITH TIME ZONE DEFAULT (NOW() + INTERVAL '30 days')
);

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ reputation_analyses
CREATE INDEX idx_reputation_analyses_user_id ON reputation_analyses(user_id);
CREATE INDEX idx_reputation_analyses_status ON reputation_analyses(status);
CREATE INDEX idx_reputation_analyses_created_at ON reputation_analyses(created_at DESC);
CREATE INDEX idx_reputation_analyses_target_phone ON reputation_analyses(target_phone) WHERE target_phone IS NOT NULL;
CREATE INDEX idx_reputation_analyses_target_email ON reputation_analyses(target_email) WHERE target_email IS NOT NULL;
CREATE INDEX idx_reputation_analyses_expires_at ON reputation_analyses(expires_at);
CREATE INDEX idx_reputation_analyses_risk_score ON reputation_analyses(risk_score DESC) WHERE risk_score IS NOT NULL;
CREATE INDEX idx_reputation_analyses_analysis_type ON reputation_analyses(analysis_type);

-- ÐŸÐ¾Ð»Ð½Ð¾Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¿Ð¾Ð¸ÑÐº
CREATE INDEX idx_reputation_analyses_target_name_gin ON reputation_analyses USING gin(to_tsvector('russian', target_name)) WHERE target_name IS NOT NULL;

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ reputation_analyses
COMMENT ON TABLE reputation_analyses IS 'ÐÐ½Ð°Ð»Ð¸Ð·Ñ‹ Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹';
COMMENT ON COLUMN reputation_analyses.risk_score IS 'ÐžÐ±Ñ‰Ð¸Ð¹ Ñ€Ð¸ÑÐº-ÑÐºÐ¾Ñ€ (0-100, Ð²Ñ‹ÑˆÐµ = Ð±Ð¾Ð»ÐµÐµ Ñ€Ð¸ÑÐºÐ¾Ð²Ð°Ð½Ð½Ð¾)';
COMMENT ON COLUMN reputation_analyses.credibility_score IS 'Ð¡ÐºÐ¾Ñ€ Ð´Ð¾ÑÑ‚Ð¾Ð²ÐµÑ€Ð½Ð¾ÑÑ‚Ð¸ (0-100, Ð²Ñ‹ÑˆÐµ = Ð±Ð¾Ð»ÐµÐµ Ð´Ð¾ÑÑ‚Ð¾Ð²ÐµÑ€Ð½Ð¾)';
COMMENT ON COLUMN reputation_analyses.sentiment_score IS 'ÐžÐ±Ñ‰Ð°Ñ Ñ‚Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹ (-1.0 Ð´Ð¾ 1.0)';
COMMENT ON COLUMN reputation_analyses.expires_at IS 'Ð”Ð°Ñ‚Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð°Ð½Ð°Ð»Ð¸Ð·Ð°';
```

#### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° reputation_sources
```sql
-- Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¸
CREATE TABLE reputation_sources (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    analysis_id UUID NOT NULL REFERENCES reputation_analyses(id) ON DELETE CASCADE,
    
    -- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ð± Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐµ
    source_type VARCHAR(100) NOT NULL, -- 'vk', 'telegram', 'instagram', 'court_records', etc.
    source_name VARCHAR(255), -- "VKontakte", "Ð¡ÑƒÐ´ÐµÐ±Ð½Ñ‹Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ", "Ð Ð˜Ð ÐÐ¾Ð²Ð¾ÑÑ‚Ð¸"
    source_url TEXT,
    source_category VARCHAR(50) 
        CHECK (source_category IN ('social_media', 'public_records', 'news', 'professional', 'legal', 'financial')),
    
    -- ÐÐ°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
    data_found JSONB DEFAULT '{}',
    content_type VARCHAR(50) 
        CHECK (content_type IN ('profile', 'post', 'comment', 'article', 'record', 'document', 'image', 'video')),
    content_summary TEXT,
    content_full_text TEXT,
    content_date TIMESTAMP WITH TIME ZONE,
    content_language VARCHAR(10) DEFAULT 'ru',
    
    -- ÐÐ½Ð°Ð»Ð¸Ð· Ð´Ð°Ð½Ð½Ñ‹Ñ…
    relevance_score DECIMAL(3,2) CHECK (relevance_score >= 0.00 AND relevance_score <= 1.00),
    credibility_score DECIMAL(3,2) CHECK (credibility_score >= 0.00 AND credibility_score <= 1.00),
    sentiment DECIMAL(3,2) CHECK (sentiment >= -1.00 AND sentiment <= 1.00),
    impact_score DECIMAL(3,2) CHECK (impact_score >= 0.00 AND impact_score <= 1.00),
    
    -- ÐšÐ»Ð°ÑÑÐ¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°
    risk_indicators JSONB DEFAULT '[]',
    positive_indicators JSONB DEFAULT '[]',
    tags JSONB DEFAULT '[]',
    categories JSONB DEFAULT '[]',
    
    -- Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ
    extraction_method VARCHAR(50) 
        CHECK (extraction_method IN ('api', 'scraping', 'manual', 'partner_feed')),
    data_quality VARCHAR(50) DEFAULT 'good' 
        CHECK (data_quality IN ('poor', 'fair', 'good', 'excellent')),
    verification_status VARCHAR(50) DEFAULT 'unverified' 
        CHECK (verification_status IN ('unverified', 'verified', 'disputed', 'fake')),
    
    -- ÐœÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ
    metadata JSONB DEFAULT '{}',
    processing_notes TEXT,
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ reputation_sources
CREATE INDEX idx_reputation_sources_analysis_id ON reputation_sources(analysis_id);
CREATE INDEX idx_reputation_sources_source_type ON reputation_sources(source_type);
CREATE INDEX idx_reputation_sources_source_category ON reputation_sources(source_category);
CREATE INDEX idx_reputation_sources_relevance ON reputation_sources(relevance_score DESC);
CREATE INDEX idx_reputation_sources_content_date ON reputation_sources(content_date DESC) WHERE content_date IS NOT NULL;
CREATE INDEX idx_reputation_sources_sentiment ON reputation_sources(sentiment);

-- ÐŸÐ¾Ð»Ð½Ð¾Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¿Ð¾Ð¸ÑÐº Ð¿Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ñƒ
CREATE INDEX idx_reputation_sources_content_gin ON reputation_sources USING gin(to_tsvector('russian', content_summary)) WHERE content_summary IS NOT NULL;

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ reputation_sources
COMMENT ON TABLE reputation_sources IS 'ÐžÑ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¸ Ð°Ð½Ð°Ð»Ð¸Ð·Ðµ Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸Ð¸';
COMMENT ON COLUMN reputation_sources.relevance_score IS 'ÐÐ°ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚ÐµÐ½ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº Ðº Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¼Ñƒ Ð»Ð¸Ñ†Ñƒ (0.0-1.0)';
COMMENT ON COLUMN reputation_sources.impact_score IS 'Ð’Ð»Ð¸ÑÐ½Ð¸Ðµ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ° Ð½Ð° Ð¾Ð±Ñ‰ÑƒÑŽ Ñ€ÐµÐ¿ÑƒÑ‚Ð°Ñ†Ð¸ÑŽ (0.0-1.0)';
```

### 3. Ð”ÐµÑ‚ÐµÐºÑ†Ð¸Ñ Ð´Ð¸Ð¿Ñ„ÐµÐ¹ÐºÐ¾Ð²

#### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° deepfake_detections
```sql
-- =====================================================
-- 3. Ð”Ð•Ð¢Ð•ÐšÐ¦Ð˜Ð¯ Ð”Ð˜ÐŸÐ¤Ð•Ð™ÐšÐžÐ’
-- =====================================================

-- ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ð´ÐµÑ‚ÐµÐºÑ†Ð¸Ð¸ Ð´Ð¸Ð¿Ñ„ÐµÐ¹ÐºÐ¾Ð²
CREATE TABLE deepfake_detections (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð¼ÐµÐ´Ð¸Ð°Ñ„Ð°Ð¹Ð»Ðµ
    media_url TEXT NOT NULL,
    media_type VARCHAR(20) NOT NULL 
        CHECK (media_type IN ('image', 'video', 'audio')),
    file_size_bytes BIGINT,
    file_format VARCHAR(20), -- 'mp4', 'jpg', 'png', 'wav', etc.
    file_hash VARCHAR(64), -- SHA-256 Ñ…ÐµÑˆ Ñ„Ð°Ð¹Ð»Ð°
    
    -- Ð¥Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð¼ÐµÐ´Ð¸Ð°
    duration_seconds DECIMAL(10,3), -- Ð´Ð»Ñ Ð²Ð¸Ð´ÐµÐ¾/Ð°ÑƒÐ´Ð¸Ð¾
    resolution VARCHAR(20), -- "1920x1080"
    frame_rate DECIMAL(6,3), -- Ð´Ð»Ñ Ð²Ð¸Ð´ÐµÐ¾
    bitrate INTEGER, -- Ð±Ð¸Ñ‚Ñ€ÐµÐ¹Ñ‚
    codec VARCHAR(50), -- ÐºÐ¾Ð´ÐµÐº
    
    -- ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
    analysis_type VARCHAR(50) NOT NULL 
        CHECK (analysis_type IN ('quick', 'standard', 'detailed', 'forensic')),
    detection_models JSONB DEFAULT '["face_detection", "temporal_analysis", "compression_artifacts"]',
    analysis_settings JSONB DEFAULT '{}',
    
    -- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
    status VARCHAR(50) DEFAULT 'pending' 
        CHECK (status IN ('pending', 'processing', 'completed', 'failed', 'cancelled')),
    progress_percentage INTEGER DEFAULT 0 
        CHECK (progress_percentage >= 0 AND progress_percentage <= 100),
    current_stage VARCHAR(100),
    
    -- ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð´ÐµÑ‚ÐµÐºÑ†Ð¸Ð¸
    deepfake_probability DECIMAL(5,4) 
        CHECK (deepfake_probability >= 0.0000 AND deepfake_probability <= 1.0000),
    authenticity_score DECIMAL(5,4) 
        CHECK (authenticity_score >= 0.0000 AND authenticity_score <= 1.0000),
    confidence_score DECIMAL(5,4) 
        CHECK (confidence_score >= 0.0000 AND confidence_score <= 1.0000),
    
    -- Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
    face_analysis JSONB DEFAULT '{}', -- Ð°Ð½Ð°Ð»Ð¸Ð· Ð»Ð¸Ñ†
    temporal_analysis JSONB DEFAULT '{}', -- Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð½ÐµÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ
    compression_analysis JSONB DEFAULT '{}', -- Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ñ‹ ÑÐ¶Ð°Ñ‚Ð¸Ñ
    metadata_analysis JSONB DEFAULT '{}', -- Ð°Ð½Ð°Ð»Ð¸Ð· Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ…
    technical_analysis JSONB DEFAULT '{}', -- Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·
    
    -- ÐÐ°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ñ‹
    artifacts_found JSONB DEFAULT '[]',
    inconsistencies JSONB DEFAULT '[]',
    anomalies JSONB DEFAULT '[]',
    
    -- Ð—Ð°ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
    verdict VARCHAR(50) 
        CHECK (verdict IN ('authentic', 'likely_authentic', 'suspicious', 'likely_deepfake', 'deepfake', 'inconclusive')),
    verdict_confidence DECIMAL(3,2) 
        CHECK (verdict_confidence >= 0.00 AND verdict_confidence <= 1.00),
    explanation TEXT,
    technical_details TEXT,
    recommendations TEXT,
    
    -- Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ
    detection_details JSONB DEFAULT '{}',
    quality_assessment JSONB DEFAULT '{}',
    risk_assessment JSONB DEFAULT '{}',
    
    -- Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ
    credits_used INTEGER DEFAULT 1,
    processing_time_ms INTEGER,
    ai_model_version VARCHAR(50),
    detection_engine VARCHAR(50) DEFAULT 'aidi_v1',
    
    -- ÐžÑˆÐ¸Ð±ÐºÐ¸
    error_message TEXT,
    warnings JSONB DEFAULT '[]',
    
    -- Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚ÐºÐ¸
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    started_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    expires_at TIMESTAMP WITH TIME ZONE DEFAULT (NOW() + INTERVAL '30 days')
);

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ deepfake_detections
CREATE INDEX idx_deepfake_detections_user_id ON deepfake_detections(user_id);
CREATE INDEX idx_deepfake_detections_status ON deepfake_detections(status);
CREATE INDEX idx_deepfake_detections_created_at ON deepfake_detections(created_at DESC);
CREATE INDEX idx_deepfake_detections_media_type ON deepfake_detections(media_type);
CREATE INDEX idx_deepfake_detections_verdict ON deepfake_detections(verdict);
CREATE INDEX idx_deepfake_detections_expires_at ON deepfake_detections(expires_at);
CREATE INDEX idx_deepfake_detections_file_hash ON deepfake_detections(file_hash) WHERE file_hash IS NOT NULL;
CREATE INDEX idx_deepfake_detections_deepfake_prob ON deepfake_detections(deepfake_probability DESC) WHERE deepfake_probability IS NOT NULL;

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ deepfake_detections
COMMENT ON TABLE deepfake_detections IS 'ÐÐ½Ð°Ð»Ð¸Ð·Ñ‹ Ð¼ÐµÐ´Ð¸Ð°Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð½Ð° Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚ Ð´Ð¸Ð¿Ñ„ÐµÐ¹ÐºÐ¾Ð²';
COMMENT ON COLUMN deepfake_detections.deepfake_probability IS 'Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ Ñ‚Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾ Ð¼ÐµÐ´Ð¸Ð° ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð´Ð¸Ð¿Ñ„ÐµÐ¹ÐºÐ¾Ð¼ (0.0-1.0)';
COMMENT ON COLUMN deepfake_detections.authenticity_score IS 'Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾Ð´Ð»Ð¸Ð½Ð½Ð¾ÑÑ‚Ð¸ Ð¼ÐµÐ´Ð¸Ð° (0.0-1.0)';
COMMENT ON COLUMN deepfake_detections.confidence_score IS 'Ð£Ð²ÐµÑ€ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ Ð² Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ðµ Ð´ÐµÑ‚ÐµÐºÑ†Ð¸Ð¸ (0.0-1.0)';
```

### 4. KYC Ð²ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ

#### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° kyc_verifications
```sql
-- =====================================================
-- 4. KYC Ð’Ð•Ð Ð˜Ð¤Ð˜ÐšÐÐ¦Ð˜Ð¯
-- =====================================================

-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° KYC Ð²ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¹
CREATE TABLE kyc_verifications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- Ð¢Ð¸Ð¿ Ð²ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸
    verification_type VARCHAR(50) NOT NULL 
        CHECK (verification_type IN ('document', 'selfie', 'video', 'biometric', 'full_kyc')),
    document_type VARCHAR(50) 
        CHECK (document_type IN ('passport', 'driver_license', 'id_card', 'foreign_passport')),
    
    -- Ð—Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
    document_front_url TEXT,
    document_back_url TEXT,
    selfie_url TEXT,
    video_url TEXT,
    additional_documents JSONB DEFAULT '[]',
    
    -- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð²ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸
    status VARCHAR(50) DEFAULT 'pending' 
        CHECK (status IN ('pending', 'processing', 'approved', 'rejected', 'expired', 'requires_review')),
    verification_level VARCHAR(50) DEFAULT 'basic' 
        CHECK (verification_level IN ('basic', 'enhanced', 'premium', 'institutional')),
    
    -- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸
    document_authenticity_score DECIMAL(3,2) 
        CHECK (document_authenticity_score >= 0.00 AND document_authenticity_score <= 1.00),
    face_match_score DECIMAL(3,2) 
        CHECK (face_match_score >= 0.00 AND face_match_score <= 1.00),
    liveness_score DECIMAL(3,2) 
        CHECK (liveness_score >= 0.00 AND liveness_score <= 1.00),
    overall_confidence DECIMAL(3,2) 
        CHECK (overall_confidence >= 0.00 AND overall_confidence <= 1.00),
    
    -- Ð˜Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
    extracted_data JSONB DEFAULT '{}', -- Ð¸Ð¼Ñ, Ð´Ð°Ñ‚Ð° Ñ€Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ, Ð½Ð¾Ð¼ÐµÑ€ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð° Ð¸ Ñ‚.Ð´.
    document_data JSONB DEFAULT '{}', -- ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°
    biometric_data JSONB DEFAULT '{}', -- Ð±Ð¸Ð¾Ð¼ÐµÑ‚Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ (Ñ…ÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ)
    
    -- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¾Ðº
    verification_details JSONB DEFAULT '{}',
    security_checks JSONB DEFAULT '{}',
    fraud_indicators JSONB DEFAULT '[]',
    
    -- ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ñ‹ Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¸Ñ Ð¸ Ð·Ð°Ð¼ÐµÑ‚ÐºÐ¸
    rejection_reasons JSONB DEFAULT '[]',
    manual_review_notes TEXT,
    reviewer_id UUID REFERENCES users(id),
    compliance_notes TEXT,
    
    -- Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ
    credits_used INTEGER DEFAULT 2,
    processing_time_ms INTEGER,
    ai_model_version VARCHAR(50),
    verification_provider VARCHAR(50) DEFAULT 'aidi_internal',
    
    -- Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚ÐºÐ¸
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    submitted_at TIMESTAMP WITH TIME ZONE,
    processed_at TIMESTAMP WITH TIME ZONE,
    expires_at TIMESTAMP WITH TIME ZONE DEFAULT (NOW() + INTERVAL '1 year')
);

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ kyc_verifications
CREATE INDEX idx_kyc_verifications_user_id ON kyc_verifications(user_id);
CREATE INDEX idx_kyc_verifications_status ON kyc_verifications(status);
CREATE INDEX idx_kyc_verifications_verification_type ON kyc_verifications(verification_type);
CREATE INDEX idx_kyc_verifications_verification_level ON kyc_verifications(verification_level);
CREATE INDEX idx_kyc_verifications_expires_at ON kyc_verifications(expires_at);
CREATE INDEX idx_kyc_verifications_created_at ON kyc_verifications(created_at DESC);

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ kyc_verifications
COMMENT ON TABLE kyc_verifications IS 'KYC (Know Your Customer) Ð²ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹';
COMMENT ON COLUMN kyc_verifications.document_authenticity_score IS 'ÐžÑ†ÐµÐ½ÐºÐ° Ð¿Ð¾Ð´Ð»Ð¸Ð½Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð° (0.0-1.0)';
COMMENT ON COLUMN kyc_verifications.face_match_score IS 'Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ ÑÐµÐ»Ñ„Ð¸ Ñ„Ð¾Ñ‚Ð¾ Ð² Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ðµ (0.0-1.0)';
COMMENT ON COLUMN kyc_verifications.liveness_score IS 'ÐžÑ†ÐµÐ½ÐºÐ° Ð¶Ð¸Ð²Ð¾ÑÑ‚Ð¸ Ð´Ð»Ñ ÑÐµÐ»Ñ„Ð¸/Ð²Ð¸Ð´ÐµÐ¾ (0.0-1.0)';
```

### 5. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð² Ð¸ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹

#### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° credits
```sql
-- =====================================================
-- 5. Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ ÐšÐ Ð•Ð”Ð˜Ð¢ÐžÐ’ Ð˜ ÐŸÐ›ÐÐ¢Ð•Ð–Ð•Ð™
-- =====================================================

-- Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð² (Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð²Ð°Ð»ÑŽÑ‚Ð°)
CREATE TABLE credits (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
    amount INTEGER NOT NULL, -- Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼ Ð´Ð»Ñ ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ð¹
    transaction_type VARCHAR(50) NOT NULL 
        CHECK (transaction_type IN (
            'purchase', 'usage', 'refund', 'bonus', 'promotion',
            'reputation_analysis', 'deepfake_detection', 'kyc_verification',
            'api_usage', 'premium_feature', 'referral_bonus', 'cashback'
        )),
    
    -- Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ
    service_type VARCHAR(50) 
        CHECK (service_type IN ('reputation', 'deepfake', 'kyc', 'api', 'premium', 'other')),
    analysis_complexity VARCHAR(50) 
        CHECK (analysis_complexity IN ('basic', 'extended', 'deep', 'forensic')),
    
    -- Ð¡Ð²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹
    related_analysis_id UUID, -- Ð¼Ð¾Ð¶ÐµÑ‚ ÑÑÑ‹Ð»Ð°Ñ‚ÑŒÑÑ Ð½Ð° reputation_analyses Ð¸Ð»Ð¸ deepfake_detections
    related_payment_id UUID, -- ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð¿Ð»Ð°Ñ‚ÐµÐ¶
    related_verification_id UUID REFERENCES kyc_verifications(id),
    
    -- ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¸ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ
    description TEXT,
    metadata JSONB DEFAULT '{}',
    
    -- Ð‘Ð°Ð»Ð°Ð½Ñ Ð¿Ð¾ÑÐ»Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
    balance_after INTEGER NOT NULL,
    
    -- Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚ÐºÐ¸
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE -- Ð´Ð»Ñ Ð±Ð¾Ð½ÑƒÑÐ½Ñ‹Ñ… ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð²
);

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ credits
CREATE INDEX idx_credits_user_id ON credits(user_id);
CREATE INDEX idx_credits_transaction_type ON credits(transaction_type);
CREATE INDEX idx_credits_service_type ON credits(service_type);
CREATE INDEX idx_credits_created_at ON credits(created_at DESC);
CREATE INDEX idx_credits_expires_at ON credits(expires_at) WHERE expires_at IS NOT NULL;
CREATE INDEX idx_credits_related_analysis ON credits(related_analysis_id) WHERE related_analysis_id IS NOT NULL;

-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ credits
COMMENT ON TABLE credits IS 'Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð² - Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ð²Ð°Ð»ÑŽÑ‚Ð° Ð´Ð»Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ ÑƒÑÐ»ÑƒÐ³';
COMMENT ON COLUMN credits.amount IS 'ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð² (Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ - Ð¿Ð¾Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ, Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ - ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ)';
COMMENT ON COLUMN credits.service_type IS 'Ð¢Ð¸Ð¿ ÑÐµÑ€Ð²Ð¸ÑÐ°: reputation, deepfake, kyc, api, premium';
COMMENT ON COLUMN credits.analysis_complexity IS 'Ð¡Ð»Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°, Ð²Ð»Ð¸ÑÑŽÑ‰Ð°Ñ Ð½Ð° ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð² ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð°Ñ…';
COMMENT ON COLUMN credits.balance_after IS 'Ð‘Ð°Ð»Ð°Ð½Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¿Ð¾ÑÐ»Ðµ Ð´Ð°Ð½Ð½Ð¾Ð¹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸';
```

#### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° payments
```sql
-- ÐŸÐ»Ð°Ñ‚ÐµÐ¶Ð¸ (Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ° ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð²)
CREATE TABLE payments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ðµ
    amount DECIMAL(10,2) NOT NULL,
    currency VARCHAR(3) NOT